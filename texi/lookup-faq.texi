\input texinfo  @c -*-texinfo-*-
@c %**start of header
@setfilename lookup-faq.info
@settitle Lookup FAQ
@footnotestyle end
@setchapternewpage on
@c %**end of header

@set UPDATED 2000-1-1
@set EDITION 2.0
@set VERSION 2.0

@ifinfo
@dircategory The Emacs editor and associated tools
@direntry
* Lookup FAQ: (lookup-faq).     Lookup FAQ List
@end direntry

This file documents Lookup, a search interface.

Copyright @copyright{} 2000 Keisuke Nishida

Permission is granted to make and distribute verbatim copies of this
manual provided the copyright notice and this permission notice are
preserved on all copies.

@ignore
Permission is granted to process this file through TeX and print the
results, provided the printed document carries a copying permission
notice identical to this one except for the removal of this paragraph
(this paragraph not being relevant to the printed manual).

@end ignore
Permission is granted to copy and distribute modified versions of this
manual under the conditions for verbatim copying, provided that the
entire resulting derived work is distributed under the terms of a
permission notice identical to this one.

Permission is granted to copy and distribute translations of this manual
into another language, under the above conditions for modified versions,
except that this permission notice may be stated in a translation
approved by the Free Software Foundation.
@end ifinfo

@titlepage
@title Lookup FAQ
@subtitle Edition @value{EDITION}
@author Keisuke Nishida

@page
@vskip 0pt plus 1filll
Edition @value{EDITION} @*
Updated for Lookup @value{VERSION} @*
@value{UPDATED} @*

Copyright @copyright{} 2000 Keisuke Nishida

Permission is granted to make and distribute verbatim copies of this
manual provided the copyright notice and this permission notice are
preserved on all copies.

Permission is granted to copy and distribute modified versions of this
manual under the conditions for verbatim copying, provided that the
entire resulting derived work is distributed under the terms of a
permission notice identical to this one.

Permission is granted to copy and distribute translations of this manual
into another language, under the above conditions for modified versions,
except that this permission notice may be stated in a translation
approved by the Free Software Foundation.
@end titlepage

@contents

@c #####################################################################
@node Top, General Information, (dir), (dir)
@top Lookup FAQ

これは Lookup についてよくある質問とその回答をまとめたものです。何か疑問
に思うことや問題に出会ったときには、まずこの文書に答えがないか探してみて
下さい。もしここで答えが見付からなかった場合には、メーリングリストで質問
して下さい。

@menu
* General Information::  
* Dictionary::  辞書について
* Setup::   セットアップについて

* Search::  
* Environment::  

@detailmenu
 --- The Detailed Node Listing ---

一般情報

* Introduction::  
* Information::  
* Development::  

Lookup について

* Q1.1.1::  
* Q1.1.2::  

情報源について

* Q1.2.1::  
* Q1.2.2::  
* Q1.2.3::  

開発体制について

* Q1.3.1::  
* Q1.3.2::  
* Q1.1.5::  
* Q1.1.6::  

辞書について

* Dictionary Setup::  辞書の利用と設定
* Dictionary Format::  辞書フォーマット
* Dictionary Information::  個々の辞書に関する注意

辞書の利用と設定

* Q2.1::    お勧めの辞書は何ですか?
* Q2.2::    圧縮された EPWING の辞書を利用できますか？ (広辞苑第5版など)
* Q2.3::    フリーに手に入れられる辞書はありませんか?
* Q2.4::    辞書を圧縮して小さくすることは出来ませんか?
* Q2.5::    新しい辞書を読めるようにするにはどうしたらいいですか?
* Q2.6::    辞書を新たに自分で作ることは出来ませんか?

辞書フォーマット

* Q2.7::    SDIC 形式の辞書とはどのようなものですか?
* Q2.8::    dictd 形式の辞書とはどのようなものですか?

個々の辞書に関する注意

* QA.1::    
* QA.2::    
* QA.3::    
* QA.4::    
* QA.5::    

セットアップについて

* Setup General::  セットアップについて
* Supplement Package::  補助パッケージについて
* Gaiji::   外字表示について

セットアップについて

* Q4.1::    辞書を好きな順序に並べ変えることは出来ませんか?
* Q4.2::    辞書一覧が横に長くなりすぎて見辛くなってしまいます。

補助パッケージについて

* Q3.1::    補助パッケージを用いると外字部分にトーフ(□)が表示されるのですが?
* Q3.2::    補助パッケージを作成するのに便利なツールはありませんか?

外字表示について

* Q5.1::    外字が表示出来ないのですが?
* Q5.2::    それでも外字が表示出来ないのですが?
* Q5.3::    小さなフォントで外字を表示することは出来ませんか?
* Q5.4::    外字テーブルを作成するのに便利なツールはありませんか?
* Q5.5::    16 dot より大きなフォントで外字を表示するには?

検索全般について

* Q6.1::    
* Q6.2::    

利用環境別の注意点

* Mule::    
* XEmacs::  
* Meadow::  

Mule で利用する場合の注意

* Q5.1.1::  

XEmacs で利用する場合の注意

* Q5.2.1::  
* Q5.2.2::  

Meadow で利用する場合の注意

* Q5.3.1::  
* Q5.3.2::  

@end detailmenu
@end menu

@c *********************************************************************
@node General Information, Dictionary, Top, Top
@chapter 一般情報

@menu
* Introduction::  
* Information::  
* Development::  
@end menu

@node Introduction, Information, General Information, General Information
@section Lookup について

@menu
* Q1.1.1::  
* Q1.1.2::  
@end menu

@node Q1.1.1, Q1.1.2, Introduction, Introduction
@subsection Lookup とは何ですか?

Lookup は Emacs エディタで電子辞書を利用するための検索ソフトウェアです。
市販の CD-ROM 辞書やオンラインのフリー辞書などを、統一された使い勝手で
効率的に検索出来るようにデザインされています。

@node Q1.1.2,  , Q1.1.1, Introduction
@subsection Lookup の特徴は何ですか?

@node Information, Development, Introduction, General Information
@section 情報源について

@menu
* Q1.2.1::  
* Q1.2.2::  
* Q1.2.3::  
@end menu

@node Q1.2.1, Q1.2.2, Information, Information
@subsection Lookup はどこで手に入りますか?

@example
@url{http://openlab.ring.gr.jp/lookup/}
@end example

@node Q1.2.2, Q1.2.3, Q1.2.1, Information
@subsection メーリングリストはありますか?

最新版のリリースなど重要な情報は、最初にメーリングリストにアナウンスが流
れます。メーリングリストに参加するには、次のアドレスに宛てて、本文に 
subscribe と書いたメールを送って下さい。送信者のアドレスが自動的に登録さ
れます。

@example
lookup-request@@ring.gr.jp (英語)
lookup-ja-request@@ring.gr.jp (日本語)
@end example

Lookup とは直接関係がありませんが、電子辞書一般について情報交換を行なう
ためのメーリングリスト edict ML でも関連情報がやりとりされることがあります。
edict ML については、次の Web ページを参照して下さい。

@example
@url{http://openlab.ring.gr.jp/edict/}
@end example

また、NDTPD のメーリングリストでも Lookup に関連した話題の出ることがあり
ます。特に市販の CD-ROM 辞書を利用している場合、NDTPD のメーリングリスト
にも参加されることをお勧めします。NDTPD については、次のところを参照して
下さい。

@example
@url{http://www.sra.co.jp/people/m-kasahr/ndtpd/}
@end example

@node Q1.2.3,  , Q1.2.2, Information
@subsection ニュースグループはありますか?

@node Development,  , Information, General Information
@section 開発体制について

@menu
* Q1.3.1::  
* Q1.3.2::  
* Q1.1.5::  
* Q1.1.6::  
@end menu

@node Q1.3.1, Q1.3.2, Development, Development
@subsection Lookup はどのように開発されていますか?

Lookup は Ring Server プロジェクトによる OpenLab で開発されています。
Ring Server については次の FAQ 1.2 を参照して下さい。

@node Q1.3.2, Q1.1.5, Q1.3.1, Development
@subsection Ring Server とは何ですか?

@url{http://openlab.ring.gr.jp/ringserver/index.html.ja} より

@quotation
Ring Server プロジェクトは、インターネットなどの高速ネットワーク環境を
対象として、大規模なソフトウェアライブラリとソフトウェアの分散共同開発の
支援を行う共通基盤技術を研究開発し、実際に運用することによりネットワーク
社会に貢献することを目的とします。
@end quotation

この内、「分散共同開発の支援」として OpenLab というものがあり、Lookup も 
OpenLab の一つとして、Web ページやメーリングリスト等の提供を受けています。
Ring Server についてより詳しくは、次のところを参照して下さい。

@example
@url{http://www.ring.gr.jp}
@end example

@node Copyright, Q1.1.6, Q1.3.2, Development

@node Q1.1.5, Q1.1.6, Q1.3.2, Development
@subsection 著作権や配布条件はどうなっていますか?

Lookup はフリーソフトウェアです。著作権は西田圭介にあり、GNU GPL に基づ
くソフトウェアの自由な利用・改変・再配布を認めています。詳細は Lookup
配布物に含まれるファイル COPYING を参照して下さい。これの日本語訳を、次の
ところでも見ることが出来ます。

@example
@url{http://www.sra.co.jp/people/h-mieko/gpl-j.html}
@end example

ただし、これが及ぶのは Lookup 本体のソースコードのみであり、Lookup で
利用する各々の辞書、外部プログラムにはそれぞれ異なる利用許諾が与えられ
ていることに注意して下さい。特に市販の CD-ROM 辞書は通常、無制限の辞書
の複製を認めていません。著作者の権利を犯すことのないよう、注意して利用
して下さい。

Lookup 配布物に含まれるソースコードの内、いくつかのものは西田圭介以外に
著作権があります。それらは Lookup と同様の許可の元で利用・再配布が認めら
れていますが、二次利用にあたってはそれぞれの利用許諾を正確に確認して下さ
い。そのようなソースコードの一覧はファイル AUTHORS にありますが、正確な
情報はそれぞれのファイルの冒頭に記述があるので参照して下さい。

@node Q1.1.6,  , Q1.1.5, Development
@subsection バグ報告はどのようにすればいいですか?

次の事項を書いて lookup-ja@@ring.gr.jp に送って下さい。

@enumerate
@item
利用している Emacs とそのバージョン
@item
Lookup のバージョンと設定内容
@item
利用している外部プログラムとそのバージョン
@item
症状
@end enumerate

回答は直接、差出し人には送られない場合があるので、回答を期待する場合は
メーリングリストに加入して下さい。

@c *********************************************************************
@node Dictionary, Setup, General Information, Top
@chapter 辞書について

@menu
* Dictionary Setup::  辞書の利用と設定
* Dictionary Format::  辞書フォーマット
* Dictionary Information::  個々の辞書に関する注意
@end menu

@node Dictionary Setup, Dictionary Format, Dictionary, Dictionary
@section 辞書の利用と設定

@menu
* Q2.1::    お勧めの辞書は何ですか?
* Q2.2::    圧縮された EPWING の辞書を利用できますか？ (広辞苑第5版など)
* Q2.3::    フリーに手に入れられる辞書はありませんか?
* Q2.4::    辞書を圧縮して小さくすることは出来ませんか?
* Q2.5::    新しい辞書を読めるようにするにはどうしたらいいですか?
* Q2.6::    辞書を新たに自分で作ることは出来ませんか?
@end menu

@node Q2.1, Q2.2, Dictionary Setup, Dictionary Setup
@subsection お勧めの辞書は何ですか?

人によって必要となる辞書は異なるでしょうが、とりあえず筆者は、アスキー出
版局の『辞・典・盤97』を利用しています。これ一つで、国語辞典、英和・和英
辞典、現代用語辞典、百科辞典と四つの辞書が含まれており、価格も一万円足ら
ずと手頃なので、最初の一冊としてはお勧めではないでしょうか。

@example
『辞・典・盤97』アスキー出版局
1997/8/15 発売  9520円(+税)
EPWING 準拠  ISBN4-7561-1108-4
@end example

フリーソフトの文化と強く関わっている人であれば、Jargon ファイルも忘れて
はいけません。これはハッカースラングを数多く集めた用語集で、英語のマニュ
アルやメールを読むときなどに役立ちます。辞書サーバ dictd で利用出来るよ
う書式変換されたものが、Lookup からも利用出来ます。

@example
@url{ftp://ftp.dict.org/pub/dict/}
(dict-misc というアーカイブに含まれている)
@end example

これ以外にも数多くの有用な辞書があります。Lookup から利用出来るいくつか
の辞書を次のところで紹介しているので、参考にして下さい。

@example
@url{http://openlab.ring.gr.jp/lookup/dicts/}
@end example

また、電子辞書一般についてのメーリングリストなんてものもありますので、
それ以外の情報を得るためにはそちらも参照して下さい。

@example
@url{http://openlab.ring.gr.jp/edict/}
@end example

@node Q2.2, Q2.3, Q2.1, Dictionary Setup
@subsection 圧縮された EPWING の辞書を利用できますか？ (広辞苑第5版など)

Lookup で EPWING を使う場合は次の 2 通りの方法があります。

@example
a) ndtp エージェントを使う。
b) ndeb エージェントを使う。
@end example

ndtpを使う場合、圧縮された EPWING の辞書を利用可能な NDTPD バージョン 
2.3 以降をサーバとして走らせれば使えます。

もう一方の ndeb は辞書アクセスを eblook というコマンドに行わせます。
eblook は NDTPD と同じ辞書検索ライブラリ (EB ライブラリ) を使っていま
すので、圧縮されたEPWING に対応した EB ライブラリ (バージョン 2.3以降)
をリンクした eblook を作れば ndeb 経由でも使えるはずです。

より詳しい情報は、NDTPD の Web ページから得られます。

@example
@url{http://www.sra.co.jp/people/m-kasahr/ndtpd/index-ja.html}
@end example

もし利用したい辞書が上記に含まれない種類のものであるとしても、それなり
の作業さえ行なえば、利用出来るようにすることも不可能ではありません。
FAQ 2.4 を参照して下さい。

Lookup から使える辞書のリストは作成されていません。順調に動作している、
あるいは動作しなかったという情報をお持ちの方は、辞書についてのコメント
を添えてメーリングリストまでお知らせ頂けると有り難いです。

いくつかの辞書に関する注意事項が Appendix A にまとめられているので、そ
ちらも参照して下さい。

@node Q2.3, Q2.4, Q2.2, Dictionary Setup
@subsection フリーに手に入れられる辞書はありませんか?

次のところで紹介しています。

@example
@url{http://openlab.ring.gr.jp/lookup/dicts/}
@end example

他に有用な情報をお持ちの方がいましたら、メーリングリストまでお知らせ下さい。

@node Q2.4, Q2.5, Q2.3, Dictionary Setup
@subsection 辞書を圧縮して小さくすることは出来ませんか?

辞書によって異なります。

@enumerate a
@item
CD-ROM 辞書の場合

辞書を小さくすることが目的であれば、まず EPWUTIL というものを利用す
ることで、画像などの大きなデータを削除して、辞書をスリムにすることが
出来ます。辞書にもよりますが、これで 25〜100% 程度の大きさになります。
次のところで手に入ります。

@example
@url{ftp://ftp.nerimadors.or.jp/pub/epwutil/}
@end example

次に、辞書検索のために eblook あるいは NDTPD を用いるならば、EB ライブ
ラリに附属の ebzip コマンドを用いることで辞書を圧縮することが可能です。
これで更に 50〜30% 程度の大きさになります。

この両方を組み合わせることで、辞書によっては元の 1/10 程度の大きさに
まで削減出来ます。

@item
フリー辞書の場合

ndic/ndict を用いる場合には、dictd に附属の dictzip コマンドを用いる
ことで辞書を圧縮することが出来ます。
@end enumerate

@node Q2.5, Q2.6, Q2.4, Dictionary Setup
@subsection 新しい辞書を読めるようにするにはどうしたらいいですか?

現在の Lookup が対応していない種類の辞書から検索を行なえるようにするため
には、次の二つの対策があり得ます。

@enumerate a
@item
専用の検索エージェントを作る

辞書のフォーマットが一般的で同じ種類の辞書が多数存在するとか、既に専用の
検索コマンドが存在するような場合、それに合わせた検索エージェントを新たに
書くことで、Lookup からそれを利用出来るようになります。

@item
別のフォーマットに書式変換する

既に検索可能となっているフォーマットに辞書を変換することで、それを利用
出来るようになります。FAQ 2.5 を参照して下さい。

いずれにしても単純な作業ではありませんから、新たに辞書を使えるようにし
ようと考えられた方は、まずメーリングリストの方までご一報下さい。
@end enumerate

@node Q2.6,  , Q2.5, Dictionary Setup
@subsection 辞書を新たに自分で作ることは出来ませんか?

適当なフォーマットで辞書を書いて、それを Lookup で読める形に変換すれば
利用出来ます。フリーに使える辞書のフォーマット、及び変換ツールを作ろうと
いう構想はありますが、まだ具体的な作業には入っていません。興味のある方は、
edict ML まで。

@example
@url{http://openlab.ring.gr.jp/edict/}
@end example

現在、Lookup から利用できて自作可能な辞書のフォーマットとしては、下記の 
dictd 形式があります。

@node Dictionary Format, Dictionary Information, Dictionary Setup, Dictionary
@section 辞書フォーマット

@menu
* Q2.7::    SDIC 形式の辞書とはどのようなものですか?
* Q2.8::    dictd 形式の辞書とはどのようなものですか?
@end menu

@node Q2.7, Q2.8, Dictionary Format, Dictionary Format
@subsection SDIC 形式の辞書とはどのようなものですか?

検索ソフト sdic で採用されている、行指向の簡易辞書フォーマットです。
sdic については、次のところを参照して下さい。

@example
@url{http://pine.kuee.kyoto-u.ac.jp/member/tsuchiya/sdic/index.html}
@end example

@node Q2.8,  , Q2.7, Dictionary Format
@subsection dictd 形式の辞書とはどのようなものですか?

辞書サーバ dictd で用いられているフォーマットです。dict ファイルと 
index ファイルの二つのファイルから成り、dict ファイルは単なるプレーン
テキスト、index は次のような書式です。

@example
foo     A2      w
bar     Bc      Ab
baz     CK      Bi
@end example

ここで各行が一つのエントリを表わし、第一コラムが見出し語、第二コラムが
dict ファイルにおけるエントリの開始位置、第三コラムが同じく長さを表わし
ます。各コラムはタブで区切り、第二、第三コラムの値は base64 でエンコード
しなければなりません。より詳しくは、dictd のマニュアルページを参照して
下さい。

具体的な例として、このようにして変換されたいくつかの辞書が、FAQ 2.3 の
ページで紹介されているので参考にして下さい。

@node Dictionary Information,  , Dictionary Format, Dictionary
@section 個々の辞書に関する注意

@menu
* QA.1::    
* QA.2::    
* QA.3::    
* QA.4::    
* QA.5::    
@end menu

@node QA.1, QA.2, Dictionary Information, Dictionary Information
@subsection "Oxford Dictionary/Thesaurus"(EBG)

この辞書では stop-code を "0x1f090000" に指定してやる必要があります。
stop-code については FAQ 6.1 を参照して下さい。

@node QA.2, QA.3, QA.1, Dictionary Information
@subsection "American Heritage Electronic Dictionary & ROGET'S II Electronic Thesaurus"(EBG)

この辞書では stop-code を "0x1f090000" に指定してやる必要があります。
stop-code については FAQ 6.1 を参照して下さい。

@node QA.3, QA.4, QA.2, Dictionary Information
@subsection 『改訂新版 ことわざ名言の泉』(EBXA)

この辞書では stop-code を "0x1f410190" に指定してやる必要があります。
stop-code については FAQ 6.1 を参照して下さい。

@node QA.4, QA.5, QA.3, Dictionary Information
@subsection 『漢字源』(EPWING)

この辞書では stop-code を "0x1f410191" に指定してやる必要があります。
stop-code については FAQ 6.1 を参照して下さい。

@node QA.5,  , QA.4, Dictionary Information
@subsection 『治療薬マニュアル』(電子ブック版)

この辞書では stop-code を "0x1f410090" に指定してやる必要があります。
stop-code については FAQ 6.1 を参照して下さい。

@c *********************************************************************
@node Setup, Search, Dictionary, Top
@chapter セットアップについて

@menu
* Setup General::  セットアップについて
* Supplement Package::  補助パッケージについて
* Gaiji::   外字表示について
@end menu

@node Setup General, Supplement Package, Setup, Setup
@section セットアップについて

@menu
* Q4.1::    辞書を好きな順序に並べ変えることは出来ませんか?
* Q4.2::    辞書一覧が横に長くなりすぎて見辛くなってしまいます。
@end menu

@node Q4.1, Q4.2, Setup General, Setup General
@subsection 辞書を好きな順序に並べ変えることは出来ませんか?

エージェント・オプション `enable' を設定することで、そのエージェントに
含まれる辞書を指定した順序に並べ変えることが出来ます。マニュアルの
`Setup Restriction' を参照して下さい。`lookup-search-agents' の設定と
合わせて工夫すれば、自由な並べ変えが可能となります。

@node Q4.2,  , Q4.1, Setup General
@subsection 辞書一覧が横に長くなりすぎて見辛くなってしまいます。

辞書 ID や辞書のタイトルが長くなると、どうしても一覧が見辛くなってしま
います。実用上はさして支障があるわけでもありませんが、気になるようなら
次のようにして回避出来ます。

@enumerate
@item
alias の設定

`lookup-search-agents' を、例えば次のように設定することで、

@lisp
(setq lookup-search-agents 
      '((ndic "/usr/local/dict/mine" ((alias . "mine")))))
@end lisp

一覧は次のようになります。

@example
% Identfier         Title                  Method
- ---------         -----                  ------
* ndic+mine:DICT    My favorite dictionary @@<>-=r/
@end example

@item
title の設定

更に辞書のタイトルを設定すれば、もっとコンパクトにまとまります。

@lisp
(lookup-set-dictionary-option "ndic+mine:DICT" 'title "Dictionary")
@end lisp

次のようになります。

@example
% Identfier         Title               Method
- ---------         -----               ------
* ndic+mine:DICT    Dictionary          @@<>-=r/
@end example
@end enumerate

@node Supplement Package, Gaiji, Setup General, Setup
@section 補助パッケージについて

@menu
* Q3.1::    補助パッケージを用いると外字部分にトーフ(□)が表示されるのですが?
* Q3.2::    補助パッケージを作成するのに便利なツールはありませんか?
@end menu

@node Q3.1, Q3.2, Supplement Package, Supplement Package
@subsection 補助パッケージを用いると外字部分にトーフ(□)が表示されるのですが?

一部のパッケージでは外字を IPA 等のフォントで置き換えるよう設定してあり
ますが、それらのフォントがシステムにインストールされてない場合、当然表示
することが出来ません。特に次のフォントが必要となることが多いので、この
機会にインストールしておくとよいでしょう。

@example
@url{ftp://ftp.etl.go.jp/pub/mule/fonts/noncjk.tar}
@end example

FreeBSD であれば x11/etlfonts-noncjk-1.0 というパッケージがあります。

@node Q3.2,  , Q3.1, Supplement Package
@subsection 補助パッケージを作成するのに便利なツールはありませんか?

残念ながら、現在はまだありません。テンプレートから自動生成するような
ツールは用意したいと思っていますが、現時点では、既存のパッケージを参考に
一から自分で書くしかありません。外字テーブルの作成のためのツールは作られ
ています。FAQ 5.4 を参照して下さい。

@node Gaiji,  , Supplement Package, Setup
@section 外字表示について

@menu
* Q5.1::    外字が表示出来ないのですが?
* Q5.2::    それでも外字が表示出来ないのですが?
* Q5.3::    小さなフォントで外字を表示することは出来ませんか?
* Q5.4::    外字テーブルを作成するのに便利なツールはありませんか?
* Q5.5::    16 dot より大きなフォントで外字を表示するには?
@end menu

@node Q5.1, Q5.2, Gaiji, Gaiji
@subsection 外字が表示出来ないのですが?

外字を表示するために必要な設定は行なっていますか? マニュアルの `Setup
Gaiji' の節を参照して、設定を行なって下さい。もっとも、外字が表示出来
るのは X Window System や Microsoft Windows 上で Emacs を動かしている
場合に限られます。tty 上では表示出来ないので注意して下さい。

XEmacs を用いる場合は、何も行なわずとも外字が表示されるはずです。もし 
XEmacs で表示出来ないということであれば、次の FAQ 5.2 を参照して下さい。

GNU Emacs の場合は、bitmap-mule のための準備が不十分である可能性があり
ます。Emacs を起動後、*scratch* バッファで次の式を評価(各行末で C-j)し
てみて下さい。

@lisp
(require 'bitmap)
(bitmap-compose "81814242242418181818242442428181")
@end lisp

これで "X" と表示されなければ、bitmap-mule の設定に問題があります。次の
各項目をチェックして下さい。

@enumerate
@item
bitmap-mule は適切にインストールされているか。

bitmap-mule は次のところから入手出来ます。アーカイブを入手し、make
install して下さい。特に、最新の Emacs を用いる場合は、bitmap-mule 
も最新のものを用意しないと動作しない場合があるので注意して下さい。

@example
@url{ftp://ftp.jaist.ac.jp/pub/GNU/elisp/bitmap-mule/}
@end example

インストールが適切でない場合、先の式を評価したときエラーになります。

@item
bitmap フォントをインストールしているか。

bitmap-mule パッケージに含まれる bitmap フォント(etl8x16-bitmap.bdf) は 
make install ではインストールされないので、これは自分で行なう必要があり
ます。ルート権限で、例えば次のようにして下さい。

@example
# cd bitmap-mule-xx/
# bdftopcf etl8x16-bitmap.bdf | gzip > bitmap.pcf.gz
# mv bitmap.pcf.gz /usr/X11R6/lib/X11/fonts/misc/
# mkfontdir /usr/X11R6/lib/X11/fonts/misc/
# xset fp rehash
@end example

フォントがインストールされてない場合、先の式を評価したときトーフ(□)
が表示されます。

@item
フォントの大きさは 16dot にしているか。

bitmap フォントは 16 pixel で構成されるので、Emacs のフォントも高さ
16 のものを用いなければなりません。もし 14dot のフォントを用いている
場合には、表示のためには一工夫いります。FAQ 5.3 を参照して下さい。
@end enumerate

もし以上のことを確認してなお外字が表示されないということであれば、問題は 
Lookup 以外のところにあります。次の FAQ 5.2 を参照して下さい。

@node Q5.2, Q5.3, Q5.1, Gaiji
@subsection それでも外字が表示出来ないのですが?

外字表示のための準備が整っていても、利用する検索エージェントや外部プログ
ラムが外字処理に対応していなければどうにもなりません。外字表示を行なうた
めには、次のいずれかの組み合わせを利用する必要があります。

@enumerate a
@item
ndtp + NDTPD 2.0 以降

CD-ROM 辞書をネットワークで共有している場合、この組み合わせでなければ外
字は表示出来ません。NDTPD 1.x や dserver にはクライアントと外字データを
やりとりする機能が組み込まれていないので、Lookup からはどうすることも出
来ないのです。サーバのバージョンを調べるためには、コマンドラインから次の
ように実行して下さい。

@example
% telnet dserver ndtp             # dserver はサーバのホスト名
Trying xxx.xxx.xxx.xxx...
Connected to dserver.
Escape character is '^]'.
v                                 # サーバのバージョンを得る
$vndtpd version 2.1.1 on dserver.domain
Q                                 # コネクションを切断する
Connection closed by foreign host.
@end example

もし古いバージョンのサーバを用いている場合、最新の NDTPD に更新すること
をお勧めします。NDTPD は dserver と互換性があるので、ネットワーク管理者
と相談してみるといいでしょう。

@item
ndeb + eblook 1.0 以降

CD-ROM 辞書を個人利用する場合には、この組み合わせで OK です。
@end enumerate

以上のことをしてなお外字が表示出来ないというならば、Lookup にバグがある
のかもしれません。FAQ 1.6 を参照し、バグ報告を行なって下さい。

@node Q5.3, Q5.4, Q5.2, Gaiji
@subsection 小さなフォントで外字を表示することは出来ませんか?

普段 14dot などの小さなフォントを利用している場合でも、XEmacs でなら何も
問題なく外字が利用出来ますが、GNU Emacs の場合は表示に一工夫必要です。
次の二つの対策があり得ます。

@enumerate
@item
小さなフォントでも bitmap-mule を使えるよう手を加える。

bitmap フォントをリサイズした縮小フォントを作り、bitmap-mule でそれを用
いるよう手を加えることで、小さなフォントでも一応表示出来るようになります
(少し形が崩れますが)。[lookup-ja525] からはじまる一連の議論が参考になり
ます。

@item
Lookup の専用フレームだけ 16dot にする。

Lookup を独自フレームを用いるように設定し、そのフレームでは 16dot のフォ
ントを用いるようにすることで外字表示が行なえます。設定は例えば次のように
なります。

@lisp
(setq lookup-open-function 'lookup-other-frame)
(setq lookup-frame-alist
      '((menu-bar-lines . 0)
        (width . 80)
        (height . 30)
        (font . "-*-fixed-medium-r-*--16-*-iso8859-1")))
@end lisp
@end enumerate

@node Q5.4, Q5.5, Q5.3, Gaiji
@subsection 外字テーブルを作成するのに便利なツールはありませんか?

土屋さん(tsuchiya@@pine.kuee.kyoto-u.ac.jp)が作成されています。詳しくは
メーリングリストででも尋ねてみて下さい。

@node Q5.5,  , Q5.4, Gaiji
@subsection 16 dot より大きなフォントで外字を表示するには?

X Window System 上の Emacs 20.4 で 24 dot フォントを使う例で説明します。

まず、
@url{ftp://ftp.st.ryukoku.ac.jp/pub/X11/contrib/Local/bdfresize-1.4.tar.Z}
から bdfresize を入手し

@example
% bdfresize -f 15/10 etl8x16-bitmap.bdf > etl12x24-bitmap.bdf
% perl -i -pe 's/8x16-0/12x24-0/g' etl12x24-bitmap.bdf
% bdftopcf etl12x24-bitmap.bdf > etl12x24-bitmap.pcf
% cp etl12x24-bitmap.pcf /somewhere
% cd /somewhere
% mkfontdir
% xset fp rehash
@end example

のように 24 dot の外字用フォントを作成し、Xで使えるようにします。

次に、 ~/.lookup に (setq lookup-use-bitmap t) の行を追加。
~/.emacs に

@lisp
(if (eq window-system 'x)
    (progn
      (and (require 'bitmap)
         (>= emacs-major-version 20)
         (mapcar (lambda (fontset)
                   (if (= (fontset-pixel-size fontset) 24)
                       (set-fontset-font
                        fontset 'bitmap
                        "-etl-fixed-medium-r-*--24-*-100-100-m-*-bitmap.12x24-0")
                     ))
                 (fontset-list)))))
@end lisp

の設定を追加します。参考: [lookup-ja 953], [lookup-ja 955]

@c *********************************************************************
@node Search, Environment, Setup, Top
@chapter 検索全般について

@menu
* Q6.1::    
* Q6.2::    
@end menu

@node Q6.1, Q6.2, Search, Search
@subsection 辞書の中身がきちんと表示されないようなのですが?

一部の辞書では、辞書の stop-code というものを指定してやらないと内容が
きちんと表示されません。NDTPD を用いている場合、辞書の Appendix を適切
に設定して下さい。ndeb の場合、これを行なうには二つの方法があります。

@enumerate a
@item
Appendix を利用する。

NDTPD のホームページにある Appendix を利用すれば、stop-code の設定も
同時に行なわれます。Appendix を適当なディレクトリにインストールし、
次のように設定して下さい。

@lisp
(setq lookup-search-agents
      '((ndeb "/cdrom" "/usr/local/share/eb/appendix")))
@end lisp

@item
エージェント・オプションを指定する。

エージェント・オプション `stop-code' を用いることで、直接 stop-code を
設定出来ます。次のようにして下さい。

@lisp
(setq lookup-search-agents
      '((ndeb "/cdrom" ((stop-code . "0x1f090000")))))
@end lisp

stop-code として設定すべき値は、ファイル末の Appendix A にある情報を
参考にして下さい。もし情報が得られなければ、NDTPD のメーリングリスト
などで尋ねてみて下さい。
@end enumerate

@node Q6.2,  , Q6.1, Search
@subsection Lookup BUG!! Report to the mailing list"と表示されます。

ndtp エージェント を用いる場合、NDTPDの設定が適切でないと、このエラーが
起きることがあります。次の2点を確認してみてください。

@itemize @bullet
@item 利用する辞書に適した 付録 データをインストールしたか。
@footnote{各辞書の 付録 データは、
@url{ftp://ftp.sra.co.jp/pub/misc/eb/appendix/} から入手できます。}
@item ndtp.confの appendix-pathの設定は正しいか。
@end itemize

それでも、同じエラーが起きるときには、メイリングリストで聞いてみて下さい。

@c *********************************************************************
@node Environment,  , Search, Top
@chapter 利用環境別の注意点

@menu
* Mule::    
* XEmacs::  
* Meadow::  
@end menu

@node Mule, XEmacs, Environment, Environment
@section Mule で利用する場合の注意

@menu
* Q5.1.1::  
@end menu

@node Q5.1.1,  , Mule, Mule
@subsection 外字を利用する場合、Mule にパッチを当てる必要がある。

Mule 2.3 (based Emacs 19.34) で外字を用いると固まってしまうことがある。
これは Mule の current-column にバグがあるためで、外字を多く含む行で何か
しようとすると固まってしまう。特に本文整形処理のfill-region の途中で固ま
ることが多く、これは

これは Lookup のインストール後に 
lookup-vse.elc というファイルを削除することで、ある程度は回避することが
出来る。しかし他の個所で固まるケースもあり、抜本的な対策とはなっていない。

この問題の難しいところは、current-column がバイトコンパイル時に
インライン展開されてしまう(らしい)ことにある。例え current-column
を上書きするコードを後から書いても、プログラムをバイトコンパイル
してしまうとオリジナルの current-column が使われてしまう。上で
lookup-vse.elc というファイルを消すとうまくいくのも、そうすること
で lookup-vse.el に組み込まれた回避用のコードが働くためである。

この問題を完全に回避しようと思えば、Mule 本体のバグを潰してインス
トールをやり直すか、current-column と同等のしかも害のないコードを
用意して、その上で current-column を呼び出す全ての elc ファイルを
削除するしかない。しかしこれは、あまり妥当な対策とは言えない。

------------------------------------------------------------------------
--- indent.c~	Tue Feb 16 13:25:32 1999
+++ indent.c	Tue Feb 16 15:23:54 1999
@@ -518,11 +518,11 @@
 		  int bytes = char_bytes[(c = FETCH_CHAR (scan) - 0x20)];
 
 		  /* Check existence of trailing non ascii character.  */
-		  while (--bytes && scan < pos
+		  while (bytes-- && scan < pos
 			 && NONASCII_P (FETCH_CHAR (scan)))
 		    scan++;
 
-		  if (bytes)
+		  if (bytes != -1)
 		    /* Incomplete multibyte form.  */
 		    {
 		      scan = oldscan, width = 4;
------------------------------------------------------------------------

より現実的には、外字の数が少なければ問題が発生しないことを利用して、
外字置き換えを利用することで外字の数を減らしてしまうことが考えられ
る。実際、多くの外字置き換えを定義している『辞・典・盤97』の補助
パッケージを用いると、問題が起こらないということが報告されている。

結局、対策としてはユーザ側で次のようにするしかない。

 1. 自分の辞書に合わせた補助パッケージを用意する。
 2. ndeb であれば Appendix を設定する。
 3. Mule 2.3@19.28 や Emacs 20 などに乗り換える。
 4. 外字の利用を諦める。

@node XEmacs, Meadow, Mule, Environment
@section XEmacs で利用する場合の注意

@menu
* Q5.2.1::  
* Q5.2.2::  
@end menu

@node Q5.2.1, Q5.2.2, XEmacs, XEmacs
@subsection エントリ等のコラムがずれてしまうことがある。

これは日本語のフォント幅が英字の二倍とは限らないため、column による
判定ではうまくいかないため。うまくやる方法はあるのだろうけど、よく
わからない。誰か教えて。

@node Q5.2.2,  , Q5.2.1, XEmacs
@subsection リファレンスに含まれる外字の色が変わらない。

これは外字を画像として表示しているため、フォントの指定が効かないため。
画像をカラーにして誤魔化すことも可能かもしれないが、それよりは外字表示
の方法を抜本的に見直したい。

@node Meadow,  , XEmacs, Environment
@section Meadow で利用する場合の注意

@menu
* Q5.3.1::  
* Q5.3.2::  
@end menu

@node Q5.3.1, Q5.3.2, Meadow, Meadow
@subsection ディレクトリ指定時の注意

ndeb や ndnmz の設定で辞書のディレクトリを指定する場合、パスの区切り
文字としてバックスラッシュ(`\')を用いると設定が上手くいかない場合がある。
これは Meadow の外部プログラム呼び出しのバグのようで、回避するには区切り
文字にスラッシュ(`/')を用いるか、あるいは次のように設定しておくとよい。

@lisp
(define-process-argument-editing
  "/eblook\\.exe\\'"          ;; Namazu の場合は "/namazu\\.exe\\'"
  (lambda (x) (general-process-argument-editing-function x nil t)))
@end lisp

@node Q5.3.2,  , Q5.3.1, Meadow
@subsection ハングを回避する

Lookup で外部プログラム(eblook など)を用いるように設定し、その後
Meadow を終了すると、Windows95 がハングすることがある。これは Meadow の
外部プロセスの扱いに問題が残されているためで、次のように設定しておけば
回避出来ることが多い。

@lisp
(if (fboundp 'orig:delete-process)
    nil
  (fset 'orig:delete-process (symbol-function 'delete-process))
  (defun delete-process (proc)
    (sit-for 1)
    (orig:delete-process proc)))
@end lisp

@node Q5.3.3
@subsection 広辞苑第5版がまだ引けなくて困っています。

ポイントは
・ebzip は cygwin1.dll をリンクするようにして作る。
・eblook は DOS_FILE_PATH が有効になるようにして作る。
です。

> 上記のようにインストールした ebzip を使って、CD-ROM の内容を
> 	c:/usr/local/dict/kojien 
> の中に移しました。これも問題なくできました。

同時に作られた ebinfo で CD-ROM 上の辞書を調べてください。
search methods が空になっている辞書はありませんか?
もしあれば、EB library のビルドに失敗しています。
EB library を

  CC="gcc" LD="ld" ./configure; make

でビルドしてください。
この手順でビルドしていてそれでも動かないのであれば、
おそらく cygwin の update が必要です。
当方では gcc2.95でビルドしました。

上記に問題がなければ、ebzipで辞書をコピーしてください。
次に eblook で辞書が使えるか確認してください。

  eblook "ebzipでコピーした辞書のディレクトリ"

この時、ディレクトリは "eblook c:/usr/local/dict/kojien" のように、
DOS 形式で指定してください。
動作確認は
  select n(広辞苑の辞書の番号を指定) 
  search xxx(確実にヒットするはずの単語)
  content 1
  quit(終了)
で試せます。うまく動かない場合はおそらく間違ったEB library が
リンクされています。eblook をビルドする際のEB libraryは

  CC="gcc -mno-cygwin" LD="ld" ./configure

の後に、config.h に

  #define DOS_FILE_PATH 1 

を追加した後に make でビルドします。
どうしてもうまくいかない場合はこおりやまさんが用意してくださった
バイナリを使用してください。
ただし、素のb20.1の cygwin1.dll だと問題が起きるかも知れませんので、
なるべくなら御自分の環境で作られた方がいいと思います(特にebzip)。

@bye

@c Local Variables:
@c mode:outline-minor
@c outline-regexp:"@\\(ch\\|sec\\|subs\\)"
@c texinfo-column-for-description:12
@c End:
